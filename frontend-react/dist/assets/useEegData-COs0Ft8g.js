import{a2 as Z,a3 as g,a4 as p,a5 as d,a6 as ee,a7 as ae,a8 as m,a9 as D}from"./index-uGH6I1cH.js";const C={eegDataList:[],selectedEegData:null,searchParams:{},loadingState:{isLoading:!1,error:void 0},pagination:{currentPage:1,pageSize:10,totalItems:0,totalPages:0},uploadProgress:{}},te=Z((e,a)=>({...C,setEegDataList:r=>{e({eegDataList:r})},addEegData:r=>{const{eegDataList:s}=a();e({eegDataList:[r,...s]})},updateEegData:(r,s)=>{const{eegDataList:i}=a(),o=i.map(y=>y.id===r?{...y,...s}:y);e({eegDataList:o});const{selectedEegData:u}=a();u&&u.id===r&&e({selectedEegData:{...u,...s}})},removeEegData:r=>{const{eegDataList:s,selectedEegData:i}=a(),o=s.filter(u=>u.id!==r);e({eegDataList:o}),i&&i.id===r&&e({selectedEegData:null})},setSelectedEegData:r=>{e({selectedEegData:r})},setSearchParams:r=>{const{searchParams:s}=a();e({searchParams:{...s,...r}})},setLoadingState:r=>{const{loadingState:s}=a();e({loadingState:{...s,...r}})},setPagination:r=>{const s=a().pagination;e({pagination:{...s,...r}})},setUploadProgress:(r,s)=>{const{uploadProgress:i}=a();e({uploadProgress:{...i,[r]:s}})},clearUploadProgress:r=>{const{uploadProgress:s}=a(),{[r]:i,...o}=s;e({uploadProgress:o})},clearAll:()=>{e(C)}}));var l=(e=>(e.Edf="Edf",e.Bdf="Bdf",e.Vhdr="Vhdr",e.Set="Set",e.Fif="Fif",e.Cnt="Cnt",e.Npy="Npy",e))(l||{});const c={uploadEegData:async(e,a)=>{try{const r=ee(),s=new FormData;s.append("file",e.file),s.append("subjectId",e.subjectId),e.notes&&s.append("notes",e.notes),e.subjectAge&&s.append("subjectAge",e.subjectAge.toString()),e.subjectGender&&s.append("subjectGender",e.subjectGender),e.subjectGroup&&s.append("subjectGroup",e.subjectGroup),e.session&&s.append("session",e.session),e.task&&s.append("task",e.task),e.acquisition&&s.append("acquisition",e.acquisition),e.tags&&e.tags.forEach(o=>s.append("tags",o));const i=await r.post("/eegdata/upload",s,{onUploadProgress:o=>{if(a&&o.total){const u=Math.round(o.loaded*100/o.total);a(u)}}});return p(i)}catch(r){return d(r)}},getUserEegData:async e=>{try{const a=await g.get("/eegdata",{params:{page:e.page,pageSize:e.pageSize}});return p(a)}catch(a){return d(a)}},getEegDataById:async e=>{try{const a=await g.get(`/eegdata/${e}`);return p(a)}catch(a){return d(a)}},updateEegData:async(e,a)=>{try{const r=await g.put(`/eegdata/${e}`,a);return p(r)}catch(r){return d(r)}},deleteEegData:async e=>{try{await g.delete(`/eegdata/${e}`)}catch(a){return d(a)}},downloadEegData:async e=>{try{return(await g.get(`/eegdata/${e}/download`,{responseType:"blob"})).data}catch(a){return d(a)}},requestAdhdAnalysis:async e=>{try{await g.post("/eegdata/analysis/request",e)}catch(a){return d(a)}},getAdhdAnalysis:async e=>{try{const a=await g.get(`/eegdata/${e}/analysis`);return p(a)}catch(a){return d(a)}},searchEegData:async e=>{try{const a={};e.searchTerm&&(a.searchTerm=e.searchTerm),e.format&&(a.format=e.format),e.tags&&e.tags.length>0&&(a.tags=e.tags);const r=await g.get("/eegdata/search",{params:a});return p(r)}catch(a){return d(a)}},validateBidsCompliance:async e=>{try{const a=await g.get(`/eegdata/${e}/bids/validate`);return p(a)}catch(a){return d(a)}},getSupportedFormats:()=>[{value:l.Edf,label:"European Data Format",extensions:[".edf"]},{value:l.Bdf,label:"BioSemi Data Format",extensions:[".bdf"]},{value:l.Vhdr,label:"BrainVision Format",extensions:[".vhdr"]},{value:l.Set,label:"EEGLAB Format",extensions:[".set"]},{value:l.Fif,label:"FIFF Format",extensions:[".fif"]},{value:l.Cnt,label:"Neuroscan Format",extensions:[".cnt"]},{value:l.Npy,label:"NumPy Array",extensions:[".npy"]}],downloadFile:(e,a)=>{const r=window.URL.createObjectURL(e),s=document.createElement("a");s.href=r,s.download=a,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r)}},re=()=>{var L,v,j,U,Q,B,K;const e=ae(),{eegDataList:a,selectedEegData:r,searchParams:s,loadingState:i,pagination:o,uploadProgress:u,addEegData:y,updateEegData:q,removeEegData:x,setSelectedEegData:M,setSearchParams:T,setLoadingState:$,setPagination:k,setUploadProgress:G,clearUploadProgress:F}=te(),A=m({queryKey:["eegData","list",o.currentPage,o.pageSize],queryFn:()=>c.getUserEegData({page:o.currentPage,pageSize:o.pageSize}),staleTime:2*60*1e3}),R=t=>m({queryKey:["eegData","detail",t],queryFn:()=>c.getEegDataById(t),enabled:!!t,staleTime:5*60*1e3}),P=m({queryKey:["eegData","search",s],queryFn:()=>c.searchEegData(s),enabled:Object.keys(s).length>0,staleTime:30*1e3}),E=D({mutationFn:({data:t,fileId:n})=>c.uploadEegData(t,b=>{G(n,b)}),onSuccess:(t,{fileId:n})=>{y(t),F(n),e.invalidateQueries({queryKey:["eegData","list"]})},onError:(t,{fileId:n})=>{F(n),$({error:t.message})}}),f=D({mutationFn:({id:t,data:n})=>c.updateEegData(t,n),onSuccess:t=>{q(t.id,t),e.setQueryData(["eegData","detail",t.id],t),e.invalidateQueries({queryKey:["eegData","list"]})}}),h=D({mutationFn:c.deleteEegData,onSuccess:(t,n)=>{x(n),e.removeQueries({queryKey:["eegData","detail",n]}),e.invalidateQueries({queryKey:["eegData","list"]})}}),w=D({mutationFn:({id:t})=>c.downloadEegData(t),onSuccess:(t,{filename:n})=>{c.downloadFile(t,n)}}),S=D({mutationFn:c.requestAdhdAnalysis,onSuccess:(t,{eegDataId:n})=>{q(n,{adhdAnalysis:{requested:!0,performed:!1,inProgress:!0,result:"",confidence:0}}),e.invalidateQueries({queryKey:["eegData","detail",n]})}}),z=t=>m({queryKey:["eegData","analysis",t],queryFn:()=>c.getAdhdAnalysis(t),enabled:!!t,refetchInterval:n=>{var b;return(b=n.state.data)!=null&&b.inProgress?5e3:!1}}),I=t=>m({queryKey:["eegData","bids",t],queryFn:()=>c.validateBidsCompliance(t),enabled:!!t,staleTime:10*60*1e3}),N=t=>{const n=`${Date.now()}-${Math.random()}`;return E.mutateAsync({data:t,fileId:n})},V=(t,n)=>f.mutateAsync({id:t,data:n}),O=t=>h.mutateAsync(t),_=(t,n)=>w.mutateAsync({id:t,filename:n}),H=t=>S.mutateAsync({eegDataId:t}),J=t=>{T(t)},W=t=>{k(t)},X=t=>{M(t)},Y=()=>c.getSupportedFormats();return{eegDataList:A.data||a,selectedEegData:r,searchResults:P.data,searchParams:s,pagination:o,uploadProgress:u,loadingState:i,isLoading:A.isLoading,isSearching:P.isLoading,error:((L=A.error)==null?void 0:L.message)||i.error,searchError:(v=P.error)==null?void 0:v.message,isUploading:E.isPending,isUpdating:f.isPending,isDeleting:h.isPending,isDownloading:w.isPending,isRequestingAnalysis:S.isPending,uploadEegData:N,updateEegDataItem:V,deleteEegDataItem:O,downloadEegDataFile:_,requestAdhdAnalysis:H,updateSearchParams:J,updatePagination:W,selectEegData:X,getSupportedFormats:Y,getEegDataQuery:R,getAdhdAnalysisQuery:z,bidsValidationQuery:I,uploadError:(j=E.error)==null?void 0:j.message,updateError:(U=f.error)==null?void 0:U.message,deleteError:(Q=h.error)==null?void 0:Q.message,downloadError:(B=w.error)==null?void 0:B.message,analysisError:(K=S.error)==null?void 0:K.message,uploadSuccess:E.isSuccess,updateSuccess:f.isSuccess,deleteSuccess:h.isSuccess,analysisSuccess:S.isSuccess}};export{re as u};
//# sourceMappingURL=useEegData-COs0Ft8g.js.map
